<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper 태그 내부에 sql문을 넣으면 mybatis가 알아서 해준다.. -->
<mapper namespace="com.soninlawisdice.mapper.MyPageMapper">

	<!-- 마이페이지 조회 -->
	<select id="mypage" resultType="com.soninlawisdice.vo.MemberVO">
		select * from member where m_id = #{m_id}
	</select>
	
	<!-- 내 작성글 갯수 -->	
	<select id="myWriteCount" resultType="int">
        SELECT
				count(*)
		FROM
			(
			        (SELECT 
			        		T.T_NO AS I_NO, T.BT_NO, T.S_NO, T.M_NO, M.M_NICK, T.T_TITLE AS I_TITLE, T.T_CONTENT AS I_CONTENT, 
			                T.T_WRITTEN_DATE AS I_WRITTEN_DATE, T.T_UPDATED_DATE AS I_UPDATED_DATE, 
			                T.T_HIT AS I_HIT, T.T_RECOMMEND_NUM AS I_RECOMMEND_NUM, T.T_REPORT_NUM AS I_REPORT_NUM, T.T_ISLAND AS I_ISLAND 
			        FROM 	
			        		TRADE T 
			        LEFT JOIN 
			        		MEMBER M 
			        ON 		
			        		T.M_NO = M.M_NO
			        ) 
			
			UNION
			
					(SELECT 
							BW.BW_NO AS I_NO, BW.BT_NO, BW.S_NO, BW.M_NO, M.M_NICK, BW.BW_TITLE  AS I_TITLE, BW.BW_CONTENT AS I_CONTENT, 
							BW.BW_WRITTEN_DATE AS I_WRITTEN_DATE, BW.BW_UPDATED_DATE AS I_UPDATED_DATE, 
			                BW.BW_HIT AS I_HIT, BW.BW_RECOMMEND_NUM AS I_RECOMMEND_NUM, BW.BW_REPORT_NUM AS I_REPORT_NUM, BW.BW_ISLAND AS I_ISLAND 
			        FROM 
			        		BOARD_WRITE BW
			        LEFT JOIN 
			        		MEMBER M
			        ON 
			        		BW.M_NO = M.M_NO
					 ) 
			
			UNION
			
			        (SELECT 
			        		CR.CR_NO AS I_NO, CR.BT_NO, NULL, CR.M_NO, M.M_NICK, CR.CR_TITLE AS I_TITLE, CR.CR_CONTENT AS I_CONTENT, 
		                    CR.CR_WRITTEN_DATE AS I_WRITTEN_DATE, CR.CR_UPDATED_DATE AS I_UPDATED_DATE, 
		                    CR.CR_HIT AS I_HIT, CR.CR_RECOMMEND_NUM AS I_RECOMMEND_NUM, CR.CR_REPORT_NUM AS I_REPORT_NUM, CR.CR_ISLAND AS I_ISLAND
			        FROM 
			        		CAFE_REVIEW CR
			        LEFT JOIN 
			        		MEMBER M
			        ON 
			        		CR.M_NO = M.M_NO
					) 
			)
		WHERE m_no = #{m_no}
	</select>		
	<!-- 내 댓글 갯수 -->
	<select id="myReplyCount" resultType="int">
		SELECT COUNT(*) FROM CM_COMMENT
		WHERE m_no = #{m_no}
	</select>
	
	<!-- 회원정보 수정 -->
	<update id="modifyMember">
		update member set
				m_nick = #{m_nick},
				m_pw = #{m_pw},
				m_email = #{m_email},
				m_phone = #{m_phone},
				m_post = #{m_post},
				m_addr1 = #{m_addr1}, 
				m_addr2 = #{m_addr2},
				m_self = #{m_self},
				m_re_sms = #{m_re_sms},
				m_re_notice = #{m_re_notice},
				m_re_message = #{m_re_message}, 
				m_info = #{m_info}
						where m_id = #{m_id}
	</update>

</mapper>